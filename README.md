# ピッチスカウト

> あなたの声を分析して、ぴったりの曲を見つけよう

# 1. プロダクト概要

## どんな「本当に欲しい」に着目したか

カラオケで「自分に合う曲がわからない」という悩みに着目しました。

- **自分の声域を客観的に知りたい** — 自分がどの音域まで出せるのか、地声と裏声の境目はどこなのか、正確に把握したい
- **曲選びで失敗したくない** — 「歌ってみたらサビが高すぎた…」を事前に防ぎたい
- **曲の音域情報がバラバラ** — ネットで調べても情報がまとまっていない

## どんなアプローチで「本当に欲しい」を実現しましたか？

AIを活用した声域分析と、3,900曲以上の音域データベースのマッチングで解決します。

1. **AI声域分析** — マイクで数秒歌うだけで、AIがあなたの地声・裏声の音域を自動判定
2. **カラオケ音源にも対応** — カラオケで録音した音源をアップロードすると、AIがBGMからボーカルだけを分離して分析
3. **3,900曲の音域DB** — 曲ごとの最低音・最高音・裏声最高音を収録。自分の声域に合う曲をすぐに検索できる

---

# 2. プロダクトの機能

| 機能 | 説明 |
|------|------|
| 🎤 マイク録音 | ブラウザからマイクで録音。リアルタイム波形表示で録音状況を確認できる |
| 🎵 カラオケ音源分析 | カラオケで録音した音源をアップロード。Demucs（Meta AI）でボーカルを自動分離してから声域分析 |
| 📁 ファイルアップロード | アカペラ音声ファイルを直接アップロードして分析 |
| 🔍 地声/裏声の自動分類 | スペクトル分析による6指標スコアリングで、地声と裏声を自動判別。比率も表示 |
| 🎶 楽曲検索 | 3,900曲・260アーティストの音域データベースから、自分の声域に合う曲を検索 |
| 📋 アーティスト別一覧 | アーティストごとの楽曲一覧表示。ページネーション対応 |

---

# 3. 使い方・デモ

## 利用フロー

```
Step 1: 声を録音する
┌─────────────────────────────┐
│  🎤 マイクで録音             │  ← アカペラで数秒歌うだけ
│  🎵 カラオケ音源をアップロード │  ← BGMありでもOK
│  📁 ファイルをアップロード     │  ← 手持ちの音声ファイル
└─────────────────────────────┘
          ↓
Step 2: AIが声域を分析
┌─────────────────────────────┐
│  地声: mid1C ～ hiA          │
│  裏声: hiA ～ hiD            │
│  地声率: 72% / 裏声率: 28%   │
└─────────────────────────────┘
          ↓
Step 3: ぴったりの曲を検索
┌─────────────────────────────┐
│  🎶 あなたの声域に合う曲一覧  │
│  アーティスト / 曲名 / 音域   │
└─────────────────────────────┘
```

## 分析結果の例

| 項目 | 値 |
|------|------|
| 地声最低音 | mid1C (C3) |
| 地声最高音 | hiA (A4) |
| 裏声最高音 | hiD (D5) |
| 地声率 | 72% |
| 裏声率 | 28% |

<!-- TODO: スクリーンショットを追加 -->
<!-- ![録音画面](screenshots/recording.png) -->
<!-- ![分析結果画面](screenshots/result.png) -->
<!-- ![楽曲検索画面](screenshots/search.png) -->

---

# 4. 技術面でのこだわり

## 技術スタック

| レイヤー | 技術 |
|----------|------|
| フロントエンド | React 19 / TypeScript / Tailwind CSS |
| バックエンド | FastAPI (Python) / SQLite |
| 音声分析 | CREPE (ピッチ検出) / librosa (スペクトル分析) |
| ボーカル分離 | Demucs (Meta AI) |
| 音域データ | voice-key.news スクレイピング (3,900曲) |
| ノイズ除去 | noisereduce |

## アーキテクチャ概要

```
[ブラウザ]                    [FastAPI サーバー]
    │                              │
    ├─ マイク録音 ──→ WAV変換 ──→ ノイズ除去
    │                              ├─→ CREPE (ピッチ検出)
    ├─ カラオケ音源 ──→ WAV変換 ──→ Demucs (ボーカル分離)
    │                              ├─→ CREPE (ピッチ検出)
    │                              │
    │                              ├─→ スペクトル分析 (地声/裏声分類)
    │                              ├─→ 音域算出
    │                              │
    ├─ 楽曲検索 ─────────────────→ SQLite (音域DB)
    │                              │
    ←── 分析結果 / 楽曲リスト ────┘
```

## CREPEピッチ検出の精度調整

声域分析の精度はピッチ検出の品質に直結します。本プロダクトでは、CREPEの出力に対して多段階の調整を行っています。

### 多段フォールバック戦略

CREPEの推論が失敗した場合に備え、段階的にパラメータを緩和する仕組みを実装しました。

```
1回目: model=small, decoder=viterbi,          confidence≥0.5
2回目: model=small, decoder=weighted_argmax,   confidence≥0.3
3回目: model=tiny,  decoder=weighted_argmax,   confidence≥0.01
```

モデルサイズを小さく、デコーダーを軽量に、信頼度閾値を下げることで、ノイズが多い録音環境でも結果を返せるようにしています。

### 2段階オクターブエラー補正

CREPEはオクターブ単位の誤検出が起きやすいため、用途に応じた2つの補正方式を使い分けています。

- **中央値ベース補正** — 全ピッチの中央値から1オクターブ以上離れた値を補正。レジスター（地声/裏声）判定に使用
- **スペクトル分析ベース補正** — 最高音付近でスペクトルの基音エネルギー比（閾値1.2）を検証し、倍音の誤検出を排除。正確な最高音の特定に使用

### 地声/裏声の自動分類

各ピッチフレームに対して6つのスペクトル指標を算出し、スコアリングで判定します。

| 指標 | 判定基準 | 根拠 |
|------|----------|------|
| H1-H2差 | 第1倍音と第2倍音のエネルギー差 | 裏声はH1が卓越する |
| 有効倍音数 | エネルギーが閾値を超える倍音の数 | 地声は倍音が豊富 |
| 倍音減衰スロープ | 倍音列の減衰傾きの線形回帰 | 裏声は急速に減衰 |
| HNR | Harmonics-to-Noise Ratio | 裏声は息漏れが多い |
| スペクトル重心比 | 重心周波数と基本周波数の比 | 地声は重心が高い |
| 音域補正 | 絶対音高による事前確率の調整 | 高音域は裏声の可能性が高い |

## Demucsによるボーカル分離

カラオケで録った音源にはBGMが含まれるため、Meta AIが開発したDemucsモデルで音源分離を行います。アカペラ録音（`/analyze`）では16kHzモノラル変換で十分ですが、カラオケ音源（`/analyze-karaoke`）では44.1kHzステレオで変換し、Demucsの分離精度を確保しています。

## 音域データベース

[voice-key.news](https://voice-key.news/)から楽曲の音域情報をスクレイピングし、SQLiteデータベースに蓄積しています。

- **3,900曲** / **260アーティスト**
- 各曲の地声最低音・地声最高音・裏声最高音をカラオケ表記（mid1C, hiAなど）で保存
- アーティスト検索・ページネーション対応のAPIを提供

---

# 5. UI/UX面でのこだわり

## モバイルファーストデザイン

カラオケ店で使うことを想定し、スマートフォンでの操作を最優先に設計しました。

- **BottomNav** — スマホでは画面下部にナビゲーションを配置し、片手操作を実現
- **Header切替** — PC表示ではヘッダーナビに自動切替
- **レスポンシブレイアウト** — 画面サイズに応じたUI最適化

## リアルタイム波形表示

録音中にリアルタイムで音声波形を表示します。録音が正しく行われているか視覚的にフィードバックすることで、「ちゃんと録れているか不安」というユーザーの心配を解消しています。

## 3つの入力モード

ユーザーの状況に合わせて3つの録音方法を用意しました。

| モード | 利用シーン |
|--------|-----------|
| 🎤 マイク録音 | その場でアカペラで歌って分析 |
| 🎵 カラオケ録音 | カラオケ店で録ったBGM付き音源を分析 |
| 📁 ファイルアップロード | 手元にある音声ファイルを分析 |

<!-- TODO: UI スクリーンショットを追加 -->

---

# 6. 将来の展望

- **声域マッチングレコメンド** — 分析結果に基づいて「あなたにおすすめの曲」を自動提案
- **録音履歴・声域トラッキング** — 過去の分析結果を保存し、声域の変化を時系列で追跡
- **音域データベースの拡充** — vocal-range.com からの追加スクレイピングで +2,000曲を目標
- **歌唱力レーダーチャート** — 音域の広さ・安定性・地声/裏声バランスなどを多角的に可視化
- **マイページ機能** — お気に入り曲の保存、分析履歴の管理

---

# 7. デプロイメント

このアプリケーションを本番環境にデプロイするための詳細なドキュメントを用意しています。

## 📚 デプロイメントガイド

| ドキュメント | 内容 | 所要時間 | おすすめ度 |
|-------------|------|---------|-----------|
| **[GCP_DEPLOYMENT.md](GCP_DEPLOYMENT.md)** 🆕 | Google Cloud Platform完全ガイド | 60-90分 | ⭐⭐⭐⭐⭐ |
| **[QUICKSTART.md](QUICKSTART.md)** | 最速デプロイ手順 | 30-60分 | ⭐⭐⭐⭐ |
| **[DEPLOYMENT.md](DEPLOYMENT.md)** | 詳細なデプロイ・運用ガイド | - | ⭐⭐⭐⭐⭐ |
| **[REQUIREMENTS.md](REQUIREMENTS.md)** | 要件定義書 | - | ⭐⭐⭐ |

## 💻 推奨環境

### GCP（Google Cloud Platform）

- **インスタンス**: n2-standard-2 + NVIDIA T4
- **月額**: 約¥24,000〜¥39,000
- **クレジット**: 4万円で1〜2ヶ月運用可能
- **詳細**: [GCP_DEPLOYMENT.md](GCP_DEPLOYMENT.md)

### AWS（Amazon Web Services）

- **インスタンス**: c5.2xlarge または g4dn.xlarge（GPU）
- **月額**: $250〜$715
- **詳細**: [DEPLOYMENT.md](DEPLOYMENT.md)

### ローカル開発

```bash
# バックエンド
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
uvicorn main:app --reload --port 8000

# フロントエンド（別ターミナル）
cd frontend
npm install
npm start
```

---

# 8. ライセンス・お問い合わせ

## ライセンス

このプロジェクトは [LICENSE](LICENSE) に基づいて公開されています。

## お問い合わせ

- **GitHub Issues**: バグ報告・機能要望
- **プルリクエスト**: コントリビューション歓迎

---

**開発チーム**: 2026_team11  
**最終更新**: 2026年2月20日
